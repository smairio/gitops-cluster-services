# =============================================================================
# Keycloak Helm Values - Codecentric Chart (keycloakx)
# =============================================================================
# Uses official Keycloak image from quay.io
# Uses external PostgreSQL (same cluster as AWX)
# Database is created by the db-init-job
# =============================================================================

# =============================================================================
# Image - Official Keycloak from Quay.io
# =============================================================================
image:
  repository: quay.io/keycloak/keycloak
  tag: "26.0"
  pullPolicy: IfNotPresent

# =============================================================================
# Replicas
# =============================================================================
replicas: 1

# =============================================================================
# Database Configuration - External PostgreSQL
# =============================================================================
database:
  vendor: postgres
  hostname: postgres-cluster-rw.postgres.svc.cluster.local
  port: 5432
  database: keycloak
  username: keycloak
  existingSecret: keycloak-postgres-secret
  existingSecretKey: password

# =============================================================================
# Proxy Configuration (TLS terminated at ingress)
# =============================================================================
proxy:
  enabled: true
  mode: edge

# =============================================================================
# HTTP Configuration
# =============================================================================
http:
  relativePath: "/"

# =============================================================================
# Command and Arguments
# =============================================================================
command:
  - "/opt/keycloak/bin/kc.sh"
args:
  - "start"
  - "--hostname-strict=false"
  - "--http-enabled=true"

# =============================================================================
# Extra Environment Variables
# =============================================================================
extraEnv: |
  - name: KC_HEALTH_ENABLED
    value: "true"
  - name: KC_METRICS_ENABLED
    value: "true"
  - name: KEYCLOAK_ADMIN
    value: "admin"
  - name: KEYCLOAK_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-admin-secret
        key: admin-password

# =============================================================================
# Service Configuration
# =============================================================================
service:
  type: ClusterIP
  httpPort: 80
  httpsPort: 443
  httpNodePort: null
  httpsNodePort: null

# =============================================================================
# Resource Limits
# =============================================================================
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# =============================================================================
# Health Checks
# =============================================================================
livenessProbe: |
  httpGet:
    path: /health/live
    port: http
  initialDelaySeconds: 120
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe: |
  httpGet:
    path: /health/ready
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# =============================================================================
# Metrics
# =============================================================================
metrics:
  enabled: true

# =============================================================================
# Health
# =============================================================================
health:
  enabled: true

# =============================================================================
# Ingress - Disabled (managed separately)
# =============================================================================
ingress:
  enabled: false
