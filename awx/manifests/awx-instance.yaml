# =============================================================================
# AWX Instance
# =============================================================================
# NOTE: AWX operator uses a built-in Redis sidecar container that communicates
# via unix socket. External Redis is NOT supported by the operator natively.
# The bundled Redis sidecar is the recommended and most reliable approach.
# =============================================================================
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx
  namespace: awx
spec:
  # External PostgreSQL configuration
  postgres_configuration_secret: awx-postgres-secret
  
  # AWX admin credentials
  admin_user: admin
  admin_password_secret: awx-admin-secret
  
  # Secret key for encryption (used for database encryption/decryption)
  secret_key_secret: awx-secret-key
  
  # Service configuration
  service_type: ClusterIP
  
  # Ingress - managed manually
  ingress_type: none
  
  # Resource requests/limits
  web_resource_requirements:
    requests:
      cpu: 200m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
      
  task_resource_requirements:
    requests:
      cpu: 200m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi

  # Redis sidecar resources (built-in Redis)
  redis_resource_requirements:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 500m
      memory: 256Mi

  # HA replicas - reduced for cluster capacity
  web_replicas: 1
  task_replicas: 1
